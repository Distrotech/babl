# General minimalistic compile file for self contained single
# file babl_extensions

@OS_WIN32_TRUE@win32_libs = -lgw32c -liberty -lole32 -luuid -lwsock32
@OS_WIN32_TRUE@no_undefined = -no-undefined

CC = @CC@

CFILES  = $(wildcard *.c)
CFLAGS  = @CFLAGS@
SOBJS   = $(CFILES:.c=.so)
all: $(SOBJS)

CFLAGS  += -Wall

%.so: %.c
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $< $(LDADD)

# if extension needing external libraries are to be # compiled with this make
# file, each of them can be added according to the this pattern:
# extra.so: extra.c
#	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $<  [own compile and link flags]

CIE-Lab.so: CIE-Lab.c
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $< $(LDADD) -lm
lcms.so: lcms.c
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $< $(LDADD) `pkg-config lcms --cflags --libs`



#############################################################################
LDFLAGS += -shared 

#LDADD    = ../babl/.libs/libbabl.so $(win32_libs) $(no-undefined)
LDADD    = $(win32_libs) $(no-undefined)

CFLAGS  += -I../babl

clean:
	rm -f $(SOBJS)
distclean:
	rm -f $(SOBJS) Makefile
maintainer-clean: distclean
mostlyclean:

subdir       = extensions
srcdir       = @srcdir@
top_builddir = ..
INSTALL      = @INSTALL@
SHELL        = @SHELL@
ext_dir      = @prefix@@libdir@/babl-@BABL_API_VERSION@

install: user-install

user-install: all
	$(INSTALL) -d $(ext_dir)
	$(INSTALL) $(SOBJS)  $(ext_dir)
distdir:
	cp $(CFILES) $(Makefile.in) $$distdir

dvi:
	#playing along with automake
check: all

.PRECIOUS: Makefile
Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	cd $(top_builddir) &&\
	$(SHELL) ./config.status $(subdir)/Makefile
